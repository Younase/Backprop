#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include "net.h"


#define NUM_IN 35

#define NUM_OUT 10


// training set

#define IN 35
#define HIDDEN 10
#define OUT 10
#define NUMTRAIN 18

double   k[NUMTRAIN][IN] = { 
    {   0,1,1,1,1,1,0,             
        1,0,0,0,0,0,1,
        1,0,0,0,0,0,1,
        1,0,0,0,0,0,1,
        0,1,1,1,1,1,0 },

    {   0,0,0,0,0,0,0,
        0,1,0,0,0,0,1,
        1,1,1,1,1,1,1,
        0,0,0,0,0,0,1,
        0,0,0,0,0,0,0 },

    {   0,1,0,0,0,0,1,
        1,0,0,0,0,1,1,
        1,0,0,0,1,0,1,
        1,0,0,1,0,0,1,
        0,1,1,0,0,0,1 },

    {   1,0,0,0,0,1,0,
        1,0,0,0,0,0,1,
        1,0,0,1,0,0,1,
        1,1,1,0,1,0,1,
        1,0,0,0,1,1,0 },

    {   0,0,0,1,1,0,0,
        0,0,1,0,1,0,0,
        0,1,0,0,1,0,0,
        1,1,1,1,1,1,1,
        0,0,0,0,1,0,0 },

    {   1,1,1,0,0,1,0,
        1,0,1,0,0,0,1,
        1,0,1,0,0,0,1,
        1,0,1,0,0,0,1,
        1,0,0,1,1,1,0 },

    {   0,0,1,1,1,1,0,
        0,1,0,1,0,0,1,
        1,0,0,1,0,0,1,
        1,0,0,1,0,0,1,
        0,0,0,0,1,1,0 },

    {   1,0,0,0,0,0,0,             
        1,0,0,0,0,0,0,
        1,0,0,1,1,1,1,
        1,0,1,0,0,0,0,
        1,1,0,0,0,0,0 },

    {   0,1,1,0,1,1,0,
        1,0,0,1,0,0,1,
        1,0,0,1,0,0,1,
        1,0,0,1,0,0,1,
        0,1,1,0,1,1,0 },

    {   0,1,1,0,0,0,0,
        1,0,0,1,0,0,1,
        1,0,0,1,0,0,1,
        1,0,0,1,0,1,0,
        0,1,1,1,1,0,0 },

    {   1,1,1,1,0,0,0,   
        0,0,0,1,0,0,0,
        0,0,0,1,0,0,0,
        0,0,0,1,0,0,0,
        1,1,1,1,1,1,1 }, 

    {   1,1,1,1,0,1,0,   
        1,0,0,1,0,0,1,
        1,0,0,1,0,0,1,
        1,0,0,1,0,0,1,
        1,0,0,0,1,1,0 },

    {   1,0,0,0,0,0,0,    
        1,0,0,0,0,0,0,
        1,0,0,1,0,0,0,
        1,1,1,1,1,1,1,
        0,0,0,1,0,0,0 },

    {   0,1,0,0,0,1,0,    
        1,0,0,0,0,0,1,
        1,0,0,1,0,0,1,
        1,0,1,0,1,0,1,
        0,1,1,0,1,1,0 },

    {   1,0,0,0,0,1,1,  
        1,0,0,0,1,0,1,
        1,0,0,1,0,0,1,
        1,0,1,0,0,0,1,
        1,1,0,0,0,0,1 },

    {   1,1,1,1,0,0,0,   
        0,0,0,1,0,0,0,
        0,0,0,1,0,0,0,
        1,1,1,1,1,1,1,
        0,0,0,1,0,0,0 }, 

    {   0,0,0,1,1,1,0,  
        0,1,1,0,0,0,1,
        1,0,0,0,0,0,1,
        1,0,0,0,0,1,0,
        1,1,1,1,1,0,0 },

    {   0,1,1,0,0,0,1,     
        1,0,0,1,0,0,1,
        1,0,0,1,0,0,1,
        1,0,0,1,0,0,1,
        0,1,1,1,1,1,1 } };


/* desired outputs */
double   o[NUMTRAIN][OUT] = { 
    { 1,0,0,0,0,0,0,0,0,0 },
    { 0,1,0,0,0,0,0,0,0,0 },
    { 0,0,1,0,0,0,0,0,0,0 },
    { 0,0,0,1,0,0,0,0,0,0 },
    { 0,0,0,0,1,0,0,0,0,0 },
    { 0,0,0,0,0,1,0,0,0,0 },
    { 0,0,0,0,0,0,1,0,0,0 },
    { 0,0,0,0,0,0,0,1,0,0 },
    { 0,0,0,0,0,0,0,0,1,0 },
    { 0,0,0,0,0,0,0,0,0,1 },
    { 0,0,0,0,1,0,0,0,0,0 },
    { 0,0,0,0,0,1,0,0,0,0 },
    { 0,0,0,0,0,0,0,1,0,0 },
    { 0,0,0,1,0,0,0,0,0,0 },
    { 0,0,1,0,0,0,0,0,0,0 },
    { 0,0,0,0,1,0,0,0,0,0 },
    { 1,0,0,0,0,0,0,0,0,0 },
    { 0,0,0,0,0,0,0,0,0,1 } };



double lr=0.1;
int num_layers=3;
int nrns_per_layer[]={NUM_IN,HIDDEN,NUM_OUT};
char activation[]="sigmoid";

int main()
{
    char* rect = "\U00002588";
    char* space = "\U00002000";
    srand( time( NULL ) );
    network* net;
    net=net_init(num_layers, nrns_per_layer, activation);

    train(net,(double*)k,(double*)o,NUMTRAIN,lr,0.001);

    for(int i=0; i<NUMTRAIN;i++)
    {
        forward(net,k[i]);
        for( int l=0; l<7; l++ )
        {
            for( int j=0; j<5; j++ )
            {
                printf("%s",(k[i][7*j+l])==1?rect:space);
            }
            printf("\n");
        }
        forward(net,k[i]);
        for(int m=1;m<=nrns_per_layer[2];m++)
        {
            printf("%lf\t",net->neuron[num_layers-1][m]);
            printf("\n");
        }
        printf("\n\n\n");
    }


    return 0;

}
